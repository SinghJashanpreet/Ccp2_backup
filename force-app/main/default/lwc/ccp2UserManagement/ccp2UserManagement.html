<template>
    <div class="main">
        <div class="top">
            <img src={backgroundImagePC}>
            <div class="overlay">
                <!-- <h1 class="centered-text">{labels.CCP2_MembershipManagement}</h1> -->
            </div>
        </div>
        <div class="bottom">
            <div class="center-content">
                <template if:true={showUserList}>
                    <div class="main-content" style="padding: 64px calc(256px - 10%) 64px calc(256px - 10%);">
                        <h2 class="heading">会員管理</h2>
                        <template if:true={allUserLoader}>
                            <div
                                style="position: relative; width:100%; height:350px; display:flex; justify-content:center; align-items:center;">
                                <lightning-spinner alternative-text="Loading" size="small"></lightning-spinner>
                            </div>
                        </template>
                        <template if:false={allUserLoader}>
                            <div class="list-container">
                                <template for:each={allUserData} for:item="elm">
                                    <div class="list-element" key={elm.Id} data-idd={elm.Id} data-user={elm.UserId__c}
                                        onclick={handleUserClick}>
                                        <div class="list-data" data-idd={elm.Id} data-user={elm.UserId__c}>
                                            <p style="font-weight:600; width:150px; color: #E10202;" data-idd={elm.Id}
                                                data-user={elm.UserId__c}>{elm.Account.siebelAccountCode__c}</p>
                                            <p style="width:150px" data-idd={elm.Id} data-user={elm.UserId__c}>
                                                {elm.Name}</p>
                                        </div>
                                        <div class="list-data" data-idd={elm.Id} data-user={elm.UserId__c}>
                                            <p style="width:150px" data-idd={elm.Id} data-user={elm.UserId__c}>
                                                {elm.Branch__r.Name}
                                            </p>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <div class="footer-buttons">
                            <a href={homeUrl} style="color: white;"><button
                                    class="button return-button">トップに戻る</button></a>
                            <a href={addUserUrl} style="color: white; "><button
                                    class="button submit-button" >会員追加</button></a>
                        </div>

                    </div>
                </template>

                <template if:true={showUserDetails}>
                    <template if:true={userDetailsLoader}>
                        <div
                            style="position: relative; width:100%; height:350px; display:flex; justify-content:center; align-items:center;">
                            <lightning-spinner alternative-text="Loading" size="small"></lightning-spinner>
                        </div>
                    </template>
                    <template if:false={userDetailsLoader}>
                        <div class="main-content">
                            <h1 class="centered-text-inside">会員情報</h1>
                            <div class="form">
                                <div class="form_container">
                                    <div class="datarec">
                                        <div class="records">
                                            <div class="head">{labels.CCP2_CompanyName}</div>
                                            <div class="data">{userDetailData.account.name}</div>
                                        </div>
                                        <div class="records">
                                            <div class="head">{labels.CCP2_CustomerNumber}</div>
                                            <div class="data">{userDetailData.account.siebelAccountCode__c}</div>
                                        </div>
                                        <div class="records">
                                            <div class="head">{labels.CCP2_FullName}</div>
                                            <div class="data">{userDetailData.Name}</div>
                                        </div>
                                        <div class="records">
                                            <div class="head">{labels.CCP2_NameFurigana}</div>
                                            <div class="data">{userDetailData.firstNameKana__c}
                                                {userDetailData.lastNameKana__c}</div>
                                        </div>
                                        <div class="records">
                                            <div class="head">{labels.CCP2_EmployeeNumber}</div>
                                            <div class="data">{userDetailData.Employee_Code__c}</div>
                                        </div>
                                        <div class="records">
                                            <div class="head">
                                                {labels.CCP2_Affiliation}
                                            </div>
                                            <div class="dataBranch2">
                                                <template for:each={branchfromjunction} for:item="elm">
                                                    <div key={elm.Name} class="data2">{elm.Name}</div>
                                                </template>
                                            </div>
                                            <!--Changing for Combo-->
                                        <!-- Changing End -->
                                        </div>
                                        <div class="records">
                                            <div class="head">{labels.CCP2_Deploy}</div>
                                            <div class="data">{userDetailData.Department}</div>
                                        </div>
                                        <div class="records">
                                            <div class="head">{labels.CCP2_Post}</div>
                                            <div class="data">{userDetailData.Title}</div>
                                        </div>
                                        <div class="records">
                                            <div class="head">{labels.CCP2_EmailAddress}</div>
                                            <div class="data">{userDetailData.email}</div>
                                        </div>
                                        <div class="records">
                                            <div class="head">{labels.CCP2_TelephoneNumber}</div>
                                            <div class="data">{userDetailData.Phone}</div>
                                        </div>
                                        <div class="records">
                                            <div class="head">{labels.CCP2_CellphoneNumber}</div>
                                            <div class="data">{userDetailData.MobilePhone}</div>
                                        </div>
                                        <div class="records">
                                            <div class="head">{labels.CCP2_ServiceUsed}</div>
                                            <div class="dataBranch">
                                                <template for:each={userServicesData} for:item="elm">
                                                    <div key={elm} class="data">{elm}</div>
                                                </template>
                                            </div>
                                            <!-- <div class="data">Not Found</div> -->
                                        </div>
                                        <!-- <div class="records">
                                        <div class="head">Affilated Vehicles</div>
                                        <div class="data">
                                             <template for:each={vehicle} for:item="veh">
                                                <div key={veh.Id} class="record-item">
                                                    <span>{veh.Name}</span>
                                                    <br>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                    <div class="records">
                                        <div class="head">Users</div>
                                        <div class="data">
                                           <template for:each={contacts} for:item="contact">
                                                <div key={contact.Id} class="record-item">
                                                    <span>{contact.Name}</span>
                                                    <br>
                                                </div>
                                            </template> 
                                        </div>
                                    </div> -->
                                    </div>
                                    <div class="buttonEdit">
                                        <div class="btn" onclick={handleEditChange}>
                                            <P class="toedit">{labels.CCP2_ToEdit}</P>
                                        </div>
                                    </div>

                                    <!-- <div class="deleteUser" onclick={handleDeleteUser}>
                                        <lightning-icon icon-name="utility:close" size="x-small" variant="container"
                                            alternative-text="Delete User" class="slds-m-left_small Abtn icon-red"
                                            title="Delete User"></lightning-icon>
                                        <p>{labels.CCP2_DeleteThisMember}</p>
                                    </div> -->
                                    
                                </div>
                                <div class="form_footer">
                                    <div class="btn1" onclick={handleReturnClick}>
                                        <P class="toedit">会員管理へ</P>
                                    </div>
                                    <div class="deleteUser" onclick={handleDeleteUser}>
                                        <lightning-icon icon-name="utility:close" size="x-small" variant="container"
                                            alternative-text="Delete User" class="slds-m-left_small Abtn icon-red"
                                            title="Delete User"></lightning-icon>
                                        <p>この会員を削除する</p>
                                    </div>
                                </div>
                                
                            </div>

                        </div>
                    </template>


                </template>

                <template if:true={showEditUserDetails}>
                    <div class="main-content">
                        <h2 class="heading">会員情報</h2>
                        <div class="form">
                            <div class="form_container form_container_save">
                                <!-- Company Name -->
                                <div class="records">
                                    <div class="head head-save">{labels.CCP2_CompanyName}</div>
                                    <div class="data">{userDetailData.account.name}</div>
                                </div>

                                <!-- Customer Number -->
                                <div class="records">
                                    <div class="head head-save">{labels.CCP2_CustomerNumber}</div>
                                    <div class="data">{userDetailData.account.siebelAccountCode__c}</div>
                                </div>

                                <!-- Full Name -->
                                <div class="records">
                                    <div class="head head-save head-save-cnt">{labels.CCP2_FullName} <span
                                            class="reqtxt">{labels.CCP2_Required}</span></div>
                                    <div class="data">
                                        <div class="dataCellName">
                                            <span class="data-cell-item">姓</span>
                                            <span class="data-cell-item">名</span>
                                        </div>
                                        <div class="dataCellName">
                                            <input type="text" class={contactClassLastName} onchange={handleInputChange}
                                                data-field="姓" value={InputLastName} placeholder="森下" />
                                            <input type="text" class={contactClassFirstName}
                                                onchange={handleInputChange} data-field="名" value={InputFirstName}
                                                placeholder="○○" />
                                        </div>
                                    </div>
                                </div>

                                <!-- Name (furigana) -->
                                <div class="records">
                                    <div class="head head-save head-save-cnt">{labels.CCP2_NameFurigana} <span class="reqtxt">{labels.CCP2_Required}</span>
                                    </div>
                                    <div class="data">
                                        <div class="dataCellName">
                                            <span class="data-cell-item">姓（フリガナ）</span>
                                            <span class="data-cell-item">姓（フリガナ）</span>
                                        </div>
                                        <div class="dataCellName">
                                            <input type="text" class={contactClassFKanaName}
                                                onchange={handleInputChange} data-field="姓（フリガナ）" value={InputLKanaName}
                                                placeholder="モリシタ" />
                                            <input type="text" class={contactClassFKanaName}
                                                onchange={handleInputChange} data-field="名（フリガナ）" value={InputFKanaName}
                                                placeholder="○○" />
                                        </div>
                                    </div>
                                </div>

                                <!-- Employee Number -->
                                <div class="records">
                                    <div class="head head-save">{labels.CCP2_EmployeeNumber}</div>
                                    <div class="data"><input type="text" onchange={handleInputChange} data-field="社員番号"
                                            value={InputEmpCode} placeholder="A0002"></div>
                                </div>

                                <!-- Affiliation -->
                                <div class="records">
                                    <div class="head head-save">{labels.CCP2_Affiliation}</div>
                                    <div class="dataBranchedit">
                                        <div class="dataDrop">
                                            <input type="text" oninput={handleSearch} onclick={handlebranChange}
                                                class="Inputs1 icon" placeholder="選択してください">
                                            <template if:true={showlist}>
                                                <div class="lists" onclick={handleInsideClick}>
                                                    <template for:each={filteredbranch} for:item="veh">
                                                        <div key={veh.value} class="list-item"
                                                            onclick={handleBranchSelect} data-id={veh.value}>
                                                            <p>{veh.label}</p>
                                                        </div>
                                                    </template>
                                                </div>
                                            </template>
                                        </div>
                                        <div class="branchrecords">
                                            <template for:each={branchfromjunction} for:item="veh">
                                                <div key={veh.Id} class="record-item">
                                                    <lightning-icon icon-name="utility:close" size="x-small"
                                                        alternative-text="Delete" onclick={handleDeleteBranch}
                                                        data-id={veh.Id} class="filtericn"></lightning-icon>
                                                    <span>{veh.Name}</span>
                                                    <br>
                                                </div>
                                            </template>
                                            <template for:each={branch} for:item="veh">
                                                <div key={veh.Id} class="record-item">
                                                    <lightning-icon icon-name="utility:close" size="x-small"
                                                        alternative-text="Delete" onclick={handleDeleteBranch}
                                                        data-id={veh.Id} class="filtericn"></lightning-icon>
                                                    <span>{veh.Name}</span>
                                                    <br>
                                                </div>
                                            </template>
                                        </div>
                                        <!-- <div class="branchrecords">
                                            <template for:each={branch} for:item="veh">
                                                <div key={veh.Id} class="record-item">
                                                    <lightning-icon icon-name="utility:close" size="x-small"
                                                        alternative-text="Delete" onclick={handleDeleteBranch}
                                                        data-id={veh.Id} class="filtericn"></lightning-icon>
                                                    <span>{veh.Name}</span>
                                                    <br>
                                                </div>
                                            </template>
                                        </div> -->
                                    </div>
                                    <!-- </div> -->
                                </div>

                                        <!-- <template for:each={userDetailData.Branchs__r} for:item="branch">
                                            <div key={branch.Id} class="data">{branch.Name}</div>
                                        </template> -->

                                <!-- Deploy -->
                                <div class="records">
                                    <div class="head head-save">{labels.CCP2_Deploy}</div>
                                    <div class="data"><input type="text" onchange={handleInputChange} data-field="部署"
                                            value={InputDepartment} placeholder="自動・製造・エネルギー"></div>
                                </div>

                                <!-- Post -->
                                <div class="records">
                                    <div class="head head-save">{labels.CCP2_Post}</div>
                                    <div class="data">
                                        <input type="text" onchange={handleInputChange} data-field="役職"
                                            value={InputPost} placeholder="課長">
                                    </div>
                                </div>

                                <!-- Email Address -->
                                <div class="records">
                                    <div class="head head-save head-save-cnt">{labels.CCP2_EmailAddress} <span class="reqtxt">{labels.CCP2_Required}</span>
                                    </div>
                                    <div class="data"><input type="text" onchange={handleInputChange}
                                            data-field="メールアドレス" value={InputEmail} class={contactClassEmail}
                                            placeholder="○○@cubastion.com"></div>
                                </div>

                                <!-- Telephone Number -->
                                <div class="records">
                                    <div class="head head-save head-save-align">{labels.CCP2_TelephoneNumber} <span class="reqtxt">{labels.CCP2_Required}</span>
                                    </div>
                                    <div class="data data-align">
                                        <div class="">電話番号か携帯番号かいずれかご入力してください。</div>
                                        <div class="">ハイフンなしでご入力ください。</div>
                                        <div class="records_number" style="margin-top: 15px;">
                                            <div class="">{labels.CCP2_TelephoneNumber}</div>
                                            <div class=""><input type="text" class={contactClassTelephone}
                                                    onchange={handleInputChange} data-field="電話番号"
                                                    value={InputTelephone} minlength="10" maxlength="10" pattern="\d*"
                                                    required placeholder="0362126800"></div>
                                        </div>
                                        <div class="records_number">
                                            <div class="">{labels.CCP2_CellphoneNumber}</div>
                                            <div class=""><input type="text" class={contactClassCellPhone}
                                                    onchange={handleInputChange} data-field="携帯番号"
                                                    value={InputCellPhone} minlength="10" maxlength="10" pattern="\d*"
                                                    required placeholder="00000000000"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Service Used -->
                                <div class="records">
                                    <div class="head head-save">{labels.CCP2_ServiceUsed}</div>
                                    <div class="data">
                                        <!-- <div class="checked-service">
                                            <input type="checkbox" checked disabled style="width:20px; height:20px; margin-right:14px; margin-bottom: 10px;">基本サービス（ふそうショップ）
                                        </div> -->
                                        
                                        <template for:each={allServicesListData} for:item="elm">
                                            <div class="checkboxContainer" key={elm.apiName}><input type="checkbox"
                                                    class="input-checkbox" style="width:20px; height:20px;"
                                                    data-field={elm.apiName} checked={elm.isActive}
                                                    onchange={handleCheckInputChange}>
                                                <span>{elm.japaneseName}</span>
                                            </div>
                                        </template>
                                    </div>
                                </div>

                                <!-- Save Button -->
                                <div class="btn-yes btn-yes-save">
                                    <div class="btn btn-save" onclick={saveFormData}>
                                        <p class="toedit txt-save">保存する</p>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </template>

                <template if:true={showDeleteScreen}>
                    <div class="delete-page">
                        <h2 class="delete-heading">会員削除完了</h2>
                        <p class="delete-text">
                            この会員の削除申請が提出しました。運営よりご連絡いたします。
                        </p>
                        <div class="btn-top" onclick={handleReturnClick2}>
                                <!-- {labels.CCP2_Return} -->
                                会員管理へ
                        </div>
                    </div>
                </template>

                <template if:true={IsUsercountZero}>
                    <div class="main-content" style="padding: 64px calc(256px - 10%) 64px calc(256px - 10%);">
                        <h2 class="heading">会員管理</h2>
                    <div class="list-container list-container-new">
                        <p class="text-para">会員がありません、追加してみませんか？</p>
                        <div class="button-container" style="display: flex; justify-content: center;">
                            <a href={addUserUrl} style="color: white; ">
                                <button class="button add-user-button">会員追加</button>
                            </a>
                        </div>
                    </div>
                
                        <div class="footer-buttons">
                            <a href={homeUrl} style="color: white;"><button
                                    class="button return-button">トップに戻る</button></a>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>


    <template if:true={showconfModal}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container custom-width-modal">
                <div class="slds-modal__content slds-text-heading_small" style="border-radius:8px; background-color: rgba(251, 251, 251, 0.8);">
                    <div class="content-modal">
                        <h1>このアカウントを削除します。<br>
                            また、そのアカウントが作成されたデータ所<br>
                            有権を管理者に移管します。
                            </h1>
                        <div class="btn-modal">
                            <button class="btn-no" style="background-color:#F4F4F4;" onclick={handleNo}>いいえ</button>
                            <button class="btn-yes" onclick={handleYes}>はい</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

</template>